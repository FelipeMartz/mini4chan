<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Red Social Innovadora</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f2f2f2;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 { margin-top: 20px; color: #333; }
  #loginDiv, #socialDiv { margin-top: 20px; width: 90%; max-width: 500px; }
  input[type="text"], textarea {
    width: 100%;
    padding: 10px;
    margin: 5px 0;
    border-radius: 5px;
    border: 1px solid #aaa;
    font-size: 14px;
    resize: none;
  }
  button {
    padding: 10px 20px;
    border: none;
    background: #333;
    color: white;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
  }
  .post {
    background: white;
    width: 100%;
    padding: 10px;
    margin: 10px 0;
    border-radius: 5px;
    box-shadow: 0px 0px 5px #ccc;
  }
  .post-header {
    font-weight: bold;
    margin-bottom: 5px;
  }
</style>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAuJNMD4d0a2uehA4UCEx7WNRlkjzWG8X8",
    authDomain: "mini4chan-50c4d.firebaseapp.com",
    projectId: "mini4chan-50c4d",
    storageBucket: "mini4chan-50c4d.firebasestorage.app",
    messagingSenderId: "476495367772",
    appId: "1:476495367772:web:3ce2ab7266bfd047eba099",
    measurementId: "G-VSC6XWFGE7"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // Funciones para cookies
  function setCookie(name, value, days) {
    const d = new Date();
    d.setTime(d.getTime() + (days*24*60*60*1000));
    document.cookie = name + "=" + value + ";path=/;expires=" + d.toUTCString();
  }
  function getCookie(name) {
    const cname = name + "=";
    const decoded = decodeURIComponent(document.cookie);
    const ca = decoded.split(';');
    for(let c of ca){
      c = c.trim();
      if(c.indexOf(cname) === 0) return c.substring(cname.length, c.length);
    }
    return "";
  }

  // DOM
  const loginDiv = document.getElementById('loginDiv');
  const socialDiv = document.getElementById('socialDiv');
  const nameInput = document.getElementById('nameInput');
  const postForm = document.getElementById('postForm');
  const postText = document.getElementById('postText');
  const postsContainer = document.getElementById('postsContainer');
  const userNameDisplay = document.getElementById('userNameDisplay');

  // Revisar si ya hay nombre en cookies
  let userName = getCookie('username');
  if(userName){
    loginDiv.style.display = 'none';
    socialDiv.style.display = 'block';
    userNameDisplay.textContent = userName;
  }

  // Ingresar nombre
  document.getElementById('nameSubmit').addEventListener('click', () => {
    const name = nameInput.value.trim();
    if(name){
      userName = name;
      setCookie('username', userName, 365);
      loginDiv.style.display = 'none';
      socialDiv.style.display = 'block';
      userNameDisplay.textContent = userName;
    }
  });

  // Enviar nuevo post
  postForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const text = postText.value.trim();
    if(text){
      await addDoc(collection(db, "posts"), {
        text: text,
        author: userName,
        timestamp: serverTimestamp()
      });
      postText.value = '';
    }
  });

  // Mostrar posts en tiempo real
  const postsQuery = query(collection(db, "posts"), orderBy("timestamp", "desc"));
  onSnapshot(postsQuery, (snapshot) => {
    postsContainer.innerHTML = '';
    snapshot.forEach((doc, index) => {
      const data = doc.data();
      const postDiv = document.createElement('div');
      postDiv.className = 'post';
      postDiv.innerHTML = `<div class="post-header">${data.author} #${snapshot.size - index}</div>
                           <div class="post-body">${data.text}</div>`;
      postsContainer.appendChild(postDiv);
    });
  });
</script>
</head>
<body>
<h1>Red Social Innovadora</h1>

<div id="loginDiv">
  <input type="text" id="nameInput" placeholder="Ingresa tu nombre" required>
  <button id="nameSubmit">Entrar</button>
</div>

<div id="socialDiv" style="display:none;">
  <p>Bienvenido, <span id="userNameDisplay"></span></p>
  <form id="postForm">
    <textarea id="postText" rows="3" placeholder="Escribe tu mensaje aquÃ­..." required></textarea><br>
    <button type="submit">Publicar</button>
  </form>
  <div id="postsContainer"></div>
</div>
</body>
</html>

